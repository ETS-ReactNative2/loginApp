{"version":3,"sources":["config.js","sdk/api.js","components/userInfo.jsx","components/home.jsx","index.js"],"names":["authDetails","environmentId","responseType","clientId","clientSecret","grantType","redirectUri","logoutRedirectUri","scope","prompt","tokenEndpointAuthMethod","maxAge","API_URI","AUTH_URI","post","apiPath","contentType","body","Promise","resolved","rejected","request","withCredentials","send","set","end","err","res","get","getBody","headers","getBaseApiUrl","useAuthUrl","config","state","nonce","acrValues","authUrl","window","location","replace","token","singOffUrl","concat","assign","grant_type","code","_","isEqual","hash","split","reduce","prev","item","Object","decodeURIComponent","crypto","msCrypto","D","Uint32Array","getRandomValues","toString","UserInfo","React","Component","constructor","props","super","this","userInfo","errorMessage","handleUserInfo","bind","hideUserInfo","getAccessToken","accessToken","sessionStorage","getItem","resolve","api","then","setItem","access_token","id_token","expires_in","setState","result","catch","error","errorDetail","includes","reject","render","alert","className","keys","map","key","type","onClick","Home","handleSignIn","handleSignOff","clearSession","removeItem","componentDidMount","test","hashes","error_description","stateMatch","href","match","codeMatch","history","replaceState","content","id","BrowserRouter","Switch","Route","routeProps","document","getElementById"],"mappings":"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","file":"static/js/main.6a02ebc5.chunk.js","sourcesContent":["export default {\r\n  // Application authorization details. For more information check \"Getting Started\" in README.md\r\n  authDetails: {\r\n    environmentId: \"fa669f8d-f31c-4b71-93b7-ca1906954c6f\",\r\n    responseType: \"token id_token\",\r\n    clientId: \"8445b17e-1d8e-4ebb-88be-502653b5570d\",\r\n    clientSecret: \"\",\r\n    grantType: \"implicit\",\r\n    // redirectUri: \"https://loginApp.surge.sh\",\r\n    redirectUri: \"http://localhost:8080\",\r\n    logoutRedirectUri: \"http://localhost:8080\",\r\n    scope: \"profile address email phone\",\r\n    prompt: \"login\",\r\n    tokenEndpointAuthMethod: \"none\",\r\n    maxAge: 3600,\r\n  },\r\n\r\n  API_URI: \"https://api.pingone.com/v1\",\r\n  AUTH_URI: \"https://auth.pingone.com\",\r\n};\r\n","/**\r\n * PingOne OpenID Connect/OAuth 2 protocol API\r\n */\r\nimport _ from \"lodash\";\r\nimport request from \"superagent\";\r\nimport config from \"../config\";\r\n\r\n\r\n/******************************************************************************\r\n *         OAuth 2/OpenID Connect Protocol API\r\n ******************************************************************************/\r\n\r\n/**\r\n *  Authorize the client\r\n *\r\n * @param environmentId a string that specifies the environment’s UUID.\r\n * @param responseType a string that specifies the code or token type returned by an authorization request. Options are token, id_token, and code. Default values is \"token id_token\". This is a required property.\r\n * @param clientId a string that specifies the application’s UUID.\r\n * @param redirectUri a string that specifies the URL that specifies the return entry point of the application. This is a required property.\r\n * @param scope a string that specifies permissions that determine the resources that the application can access. This parameter is not required, but it is needed to specify accessible resources.\r\n * @param state a string that specifies an optional parameter that is used to maintain state between the logout request and the callback to the endpoint specified by the post_logout_redirect_uri query parameter.\r\n * @param nonce a string that is used to associate a client session with an ID token, and to mitigate replay attacks. The value is passed through unmodified from the authentication request to the ID token.\r\n * @param prompt a string that specifies whether the user is prompted to login for re-authentication. The prompt parameter can be used as a way to check for existing authentication, verifying that the user is still present for the current session. For prompt=none, the user is never prompted to login to re-authenticate, which can result in an error if authentication is required. For prompt=login, if time since last login is greater than the max-age, then the current session is stashed away in the flow state and treated in the flow as if there was no previous existing session. When the flow completes, if the flow’s user is the same as the user from the stashed away session, the stashed away session is updated with the new flow data and persisted (preserving the existing session ID). If the flow’s user is not the same as the user from the stashed away session, the stashed away session is deleted (logout) and the new session is persisted.\r\n * @param maxAge a string that specifies the maximum amount of time allowed since the user last authenticated. If the max_age value is exceeded, the user must re-authenticate.\r\n * @param acr_values an optional parameter that designates whether the authentication request includes steps for a single-factor or multi-factor authentication flow. This parameter maps to the name of a sign-on policy that must be assigned to the application. For more information, see Sign-on policies.\r\n * @returns {Promise<T | never>}\r\n */\r\nconst authorize = (environmentId, responseType='token id_token', clientId, redirectUri, scope,\r\n    state, nonce, prompt = 'login', maxAge, acrValues = null) => {\r\n  let authUrl = `${getBaseApiUrl(\r\n      true)}/${environmentId}/as/authorize?` +\r\n      `response_type=${responseType}&client_id=${clientId}&redirect_uri=${redirectUri}&prompt=${prompt}` +\r\n      (scope ? `&scope=${scope}` : '') +\r\n      (maxAge ? `&max_age=${maxAge}` : '') +\r\n      (acrValues ? `&acr_values=${acrValues}` : '') +\r\n      (state ? `&state=${state}` : '') +\r\n      (nonce ? `&nonce=${nonce}` : '');\r\n  window.location.replace(authUrl);\r\n\r\n};\r\n\r\n/**\r\n * Ends the user session associated with the given ID token.\r\n * @param environmentId - a required attribute that specifies environment id\r\n * @param logoutRedirectUri - a string that specifies an optional parameter that specifies the URL to which the browser is redirected after a logout has been performed.\r\n * @param token  - a required attribute that specifies the ID token passed to the logout endpoint as a hint about the user’s current authenticated session.\r\n * @param state - a string that specifies an optional parameter that is used to maintain state between the logout request and the callback to the endpoint specified by the logoutRedirectUri query parameter\r\n * @see {@link https://openid.net/specs/openid-connect-session-1_0.html#RPLogout|RP-Initiated Logout}\r\n */\r\nconst signOff = (environmentId, logoutRedirectUri, token, state) => {\r\n  let singOffUrl = `${getBaseApiUrl(\r\n      true)}/${environmentId}/as/signoff?id_token_hint=${token}`;\r\n  if (logoutRedirectUri && state) {\r\n    singOffUrl = singOffUrl.concat(\r\n        `&post_logout_redirect_uri=${logoutRedirectUri}&state=${state}`);\r\n  }\r\n  window.location.assign(singOffUrl);\r\n};\r\n\r\n/**\r\n * Get claims about the authenticated end user from UserInfo Endpoint (OAuth 2.0 protected resource)\r\n * A userinfo authorization request is used with applications associated with the openid resource.\r\n * @param environmentId a string that specifies the environment’s UUID.\r\n * @param token access token\r\n */\r\nconst getUserInfo = (environmentId, token) => {\r\n  return get(`${getBaseApiUrl(true)}/${environmentId}/as/userinfo`, true,\r\n      {'Authorization': `Bearer ${token}`})\r\n};\r\n\r\n/**\r\n * Obtain an access token in a format of:\r\n * {access_token: \"bla\", token_type: \"Bearer\", expires_in: 3600, scope: \"address phone openid profile email\", id_token: \"bla\"}\r\n *\r\n * Note that authentication requirements to this endpoint are configured by the application’s tokenEndpointAuthMethod property\r\n * @param environmentId a string that specifies the environment’s UUID.\r\n * @param clientId a string that specifies the application’s UUID.\r\n * @param clientSecret a string that specifies the the application’s client secret. This property is required only if the application’s tokenEndpointAuthMethod property is set to client_secret_post.\r\n * @param redirectUri is a required parameter only if it was included in the original GET /{environmentId}/as/authorize request.\r\n * @param grant_type a string that specifies the grant type of the token request. Options are authorization_code, implicit, and client_credentials.\r\n * @param tokenEndpointAuthMethod a string that specifies the client authentication methods supported by the token endpoint. This is a required property. Options are none, client_secret_basic, and client_secret_post.\r\n * @param code a string that specifies the authorization code returned by the authorization server. This property is required only if the grant_type is set to authorization_code\r\n */\r\nconst getAccessToken = (environmentId, clientId, clientSecret = null,\r\n    redirectUri, grant_type = 'authorization_code', tokenEndpointAuthMethod = 'client_secret_post', code) => {\r\n  if(_.isEqual(tokenEndpointAuthMethod, 'client_secret_post')){\r\n    return post(`${getBaseApiUrl(\r\n        true)}/${environmentId}/as/token`,\r\n        'application/x-www-form-urlencoded',\r\n        `grant_type=${grant_type}&code=${code}&client_id=${clientId}`\r\n        + (clientSecret ? `&client_secret=${clientSecret}` : '')\r\n        + (redirectUri ? `&redirect_uri=${redirectUri}` : ''));\r\n  } else {\r\n    return get(`${getBaseApiUrl(\r\n        true)}/${environmentId}/as/token?grant_type=${grant_type}&code=${code}&client_id=${clientId}`\r\n        + (clientSecret ? `&client_secret=${clientSecret}` : '')\r\n        + (redirectUri ? `&redirect_uri=${redirectUri}` : ''));\r\n  }\r\n};\r\n\r\nconst post = (apiPath, contentType, body = {}) =>\r\n    new Promise((resolved, rejected) =>\r\n        request\r\n        .post(apiPath)\r\n        .withCredentials()\r\n        .send(body)\r\n        .set('Content-Type', contentType)\r\n        .end((err, res) => {\r\n          if (err) {\r\n            rejected(res ? res.body : err);\r\n          } else {\r\n            resolved(res.body);\r\n          }\r\n        }));\r\n\r\nconst get = (apiPath, getBody = false, headers = {}) =>\r\n    new Promise((resolved, rejected) =>\r\n        request\r\n        .get(apiPath)\r\n        .set(headers)\r\n        .end((err, res) => {\r\n          if (err) {\r\n            rejected(res ? res.body : err);\r\n          } else {\r\n            resolved(getBody ? res.body : res);\r\n          }\r\n        }));\r\n\r\nconst getBaseApiUrl = (useAuthUrl) => {\r\n  return useAuthUrl ?\r\n      config.AUTH_URI : // base API URL for auth things like the flow orchestration service\r\n      config.API_URI; // base API URL for non-auth things\r\n};\r\n\r\n\r\nconst parseHash = () => {\r\n  return window.location.hash.replace('#', '').split('&').reduce((prev, item) => {\r\n    return Object.assign({[item.split('=')[0]]: decodeURIComponent(item.split('=')[1])}, prev);\r\n  }, {});\r\n};\r\n\r\nconst generateRandomValue = () => {\r\n  let crypto = window.crypto || window.msCrypto;\r\n  let D = new Uint32Array(2);\r\n  crypto.getRandomValues(D);\r\n  return D[0].toString(36);\r\n};\r\n\r\n\r\nexport default {\r\n  authorize,\r\n  signOff,\r\n  getAccessToken,\r\n  getUserInfo,\r\n\r\n  parseHash,\r\n  generateRandomValue\r\n}\r\n","import React from 'react';\r\nimport api from '../sdk/api'\r\nimport PropTypes from 'prop-types';\r\nimport _ from \"lodash\";\r\n\r\n/**\r\n * React component for managing the return entry point of the implicit OAuth 2.0 flow and is expecting \"access_token\", \"id_token\" or \"code\" in a redirect uri.\r\n * The user will be redirected to this point based on the redirect_uri in config.js - the URL that specifies the return entry point of this application.\r\n */\r\nclass UserInfo extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      userInfo: null,\r\n      errorMessage: ''\r\n    };\r\n\r\n    this.handleUserInfo = this.handleUserInfo.bind(this);\r\n    this.hideUserInfo = this.hideUserInfo.bind(this);\r\n  }\r\n\r\n  getAccessToken() {\r\n    let accessToken = sessionStorage.getItem(\"access_token\");\r\n    if (!accessToken) {\r\n      return api.getAccessToken(\r\n          this.props.authDetails.environmentId,\r\n          this.props.authDetails.clientId,\r\n          this.props.authDetails.clientSecret,\r\n          this.props.authDetails.redirectUri,\r\n          this.props.authDetails.grantType,\r\n          this.props.authDetails.tokenEndpointAuthMethod,\r\n          sessionStorage.getItem(\"code\"))\r\n      .then(token => {\r\n        sessionStorage.setItem(\"access_token\", token.access_token);\r\n        sessionStorage.setItem(\"id_token\", token.id_token);\r\n        sessionStorage.setItem(\"expires_in\", token.expires_in);\r\n        sessionStorage.setItem(\"scope\", token.scope);\r\n        return Promise.resolve(token.access_token);\r\n      })\r\n    } else {\r\n      return Promise.resolve(accessToken);\r\n    }\r\n  }\r\n\r\n  hideUserInfo() {\r\n    this.setState({\r\n      userInfo: null\r\n    });\r\n  }\r\n\r\n  handleUserInfo() {\r\n    this.getAccessToken()\r\n    .then(accessToken => {\r\n      return api.getUserInfo(this.props.authDetails.environmentId, accessToken)\r\n    })\r\n    .then(result => {\r\n      this.setState({\r\n        userInfo: result\r\n      });\r\n    })\r\n    .catch(error => {\r\n      const errorDetail = _.get(error, 'details[0].code', null);\r\n      if (_.isEqual(errorDetail, 'INVALID_VALUE')) {\r\n        if (_.get(error, 'details[0].message', null).includes(\r\n            \"Access token expired\")) {\r\n          this.setState({\r\n            errorMessage: 'Your access token is expired. Please login again.'\r\n          });\r\n        } else {\r\n          this.setState({\r\n            errorMessage: _.get(error, 'details[0].message', null)\r\n          });\r\n        }\r\n      } else if (errorDetail) {\r\n        this.setState({\r\n          errorMessage: errorDetail + _.get(error, 'details[0].message', null)\r\n        });\r\n      } else if (_.get(error, 'error', null) || _.get(error,\r\n          'error_description', null)) {\r\n        this.setState({\r\n          errorMessage: _.get(error, 'error', null) + ': ' + _.get(error,\r\n              'error_description', null)\r\n        });\r\n      }\r\n      return Promise.reject(error);\r\n    })\r\n  }\r\n\r\n  render() {\r\n    const {userInfo, errorMessage} = this.state;\r\n    let alert = errorMessage && (\r\n        <div className=\"alert alert-danger\">{errorMessage}</div>\r\n    );\r\n    return userInfo ? (\r\n        <div>\r\n          {alert}\r\n          <div className=\"input-field\">\r\n            <table className=\"table\">\r\n              <thead>\r\n              <tr>\r\n                <th>Claim</th>\r\n                <th>Value</th>\r\n              </tr>\r\n              </thead>\r\n              <tbody>\r\n              {Object.keys(userInfo).map(key => (\r\n                  <tr key={key}>\r\n                    <td>{key}</td>\r\n                    <td>{userInfo[key]}</td>\r\n                  </tr>\r\n              ))}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n          <div className=\"input-field\">\r\n            <button type=\"button\" onClick={this.hideUserInfo}> Hide User\r\n              Information\r\n            </button>\r\n          </div>\r\n        </div>\r\n    ) : (\r\n        <div className=\"input-field\">\r\n          {alert}\r\n          <button type=\"button\" onClick={this.handleUserInfo}> Show User\r\n            Information\r\n          </button>\r\n        </div>\r\n    )\r\n\r\n  }\r\n}\r\n\r\nUserInfo.propTypes = {\r\n  authDetails: PropTypes.shape({\r\n    environmentId: PropTypes.string.isRequired,\r\n    clientId: PropTypes.string.isRequired,\r\n    clientSecret: PropTypes.string,\r\n    scope: PropTypes.string.isRequired,\r\n    responseType: PropTypes.string,\r\n    tokenEndpointAuthMethod: PropTypes.string.isRequired,\r\n    grantType: PropTypes.string,\r\n    prompt: PropTypes.string,\r\n    redirectUri: PropTypes.string,\r\n    logoutRedirectUri: PropTypes.string,\r\n    maxAge: PropTypes.number\r\n  }).isRequired\r\n};\r\n\r\nexport default UserInfo;\r\n","import React from 'react';\r\nimport api from '../sdk/api'\r\nimport UserInfo from './userInfo'\r\nimport PropTypes from 'prop-types';\r\nimport _ from \"lodash\";\r\n\r\n/**\r\n * React component for managing the return entry point of the implicit OAuth 2.0 flow and is expecting \"access_token\", \"id_token\" or \"code\" in a redirect uri.\r\n * The user will be redirected to this point based on the redirect_uri in config.js - the URL that specifies the return entry point of this application.\r\n */\r\nclass Home extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      userInfo: null,\r\n      errorMessage: ''\r\n    };\r\n\r\n    this.handleSignIn = this.handleSignIn.bind(this);\r\n    this.handleSignOff = this.handleSignOff.bind(this);\r\n  }\r\n\r\n  handleSignIn() {\r\n    const {authDetails} = this.props;\r\n    this.clearSession();\r\n\r\n    let state = api.generateRandomValue();\r\n    let nonce = api.generateRandomValue();\r\n    sessionStorage.setItem(\"state\", state);\r\n\r\n    api.authorize(authDetails.environmentId,\r\n        authDetails.responseType, authDetails.clientId,\r\n        authDetails.redirectUri, authDetails.scope,\r\n        state, nonce,\r\n        authDetails.prompt, authDetails.maxAge);\r\n\r\n  }\r\n\r\n  handleSignOff() {\r\n    if (sessionStorage.getItem(\"id_token\")) {\r\n      api.signOff(this.props.authDetails.environmentId,\r\n          this.props.authDetails.logoutRedirectUri,\r\n          sessionStorage.getItem(\"id_token\"), sessionStorage.getItem(\"state\"));\r\n    }\r\n\r\n    this.clearSession();\r\n  }\r\n\r\n  clearSession() {\r\n    sessionStorage.removeItem(\"access_token\");\r\n    sessionStorage.removeItem(\"id_token\");\r\n    sessionStorage.removeItem(\"code\");\r\n    sessionStorage.removeItem(\"expires_in\");\r\n    sessionStorage.removeItem(\"scope\");\r\n    sessionStorage.removeItem(\"state\");\r\n  }\r\n\r\n  componentDidMount() {\r\n    const {authDetails} = this.props;\r\n\r\n    const uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;\r\n\r\n    if (!uuidRegex.test(authDetails.environmentId)) {\r\n      this.setState({\r\n        errorMessage: `Invalid environmentId parameter ${authDetails.environmentId} : it should be a valid UUID.  Please check it in your config.js parameters file.`,\r\n      });\r\n    }\r\n\r\n    let hashes = api.parseHash();\r\n\r\n    if (hashes && hashes.error && hashes.error_description) {\r\n      this.setState({\r\n        errorMessage: hashes.error + ': ' + hashes.error_description,\r\n      });\r\n      return;\r\n    }\r\n\r\n    let stateMatch = window.location.href.match('[?#&]state=([^&]*)');\r\n    if (stateMatch && !stateMatch[1] &&\r\n        !_.isEqual(stateMatch[1], sessionStorage.getItem(\"state\"))) {\r\n      this.setState({\r\n        errorMessage: \"State parameter mismatch\"\r\n      });\r\n      return;\r\n    }\r\n\r\n    let codeMatch = window.location.href.match('[?#&]code=([^&]*)');\r\n\r\n    if (hashes && hashes.access_token && hashes.id_token && hashes.expires_in) {\r\n      sessionStorage.setItem(\"access_token\", hashes.access_token);\r\n      sessionStorage.setItem(\"id_token\", hashes.id_token);\r\n      sessionStorage.setItem(\"expires_in\", hashes.expires_in);\r\n      sessionStorage.setItem(\"scope\", hashes.scope);\r\n    } else if (codeMatch && codeMatch[1]) {\r\n      sessionStorage.setItem(\"code\", codeMatch[1]);\r\n    }\r\n    // Replace current URL without adding it to history entries\r\n    window.history.replaceState({}, '', '/');\r\n  }\r\n\r\n  render() {\r\n    const {errorMessage} = this.state;\r\n\r\n    let alert = errorMessage && (\r\n        <div className=\"alert alert-danger\">{errorMessage}</div>\r\n    );\r\n\r\n    const isNotAuthenticated = !(sessionStorage.getItem(\"access_token\")\r\n        && sessionStorage.getItem(\r\n            \"id_token\")) && !/access_token|id_token/.test(window.location.hash)\r\n        && !sessionStorage.getItem(\"code\") && !/code/.test(\r\n            window.location.href);\r\n\r\n    const content = isNotAuthenticated ?\r\n        (\r\n            <div id=\"signInView\">\r\n              <p>You are not currently authenticated. Click Sign On to get\r\n                started.</p>\r\n              <div className=\"input-field\">\r\n                <button type=\"button\" onClick={this.handleSignIn}>Sign On\r\n                </button>\r\n              </div>\r\n            </div>\r\n        ) : (\r\n            <div className=\"home-app\">\r\n              <em>\r\n                Congratulations! This is a secure resource.\r\n              </em>\r\n              <p/>\r\n              <div className=\"input-field\">\r\n                <button type=\"button\" onClick={this.handleSignOff}> Sign Off\r\n                </button>\r\n              </div>\r\n              <UserInfo authDetails={this.props.authDetails}/>\r\n            </div>\r\n        );\r\n\r\n    return (\r\n        <div className=\"container\">\r\n          <h1>PingOne for Customers OIDC Sample</h1>\r\n          {alert}\r\n          {content}\r\n        </div>\r\n    )\r\n  }\r\n}\r\n\r\nHome.propTypes = {\r\n  authDetails: PropTypes.shape({\r\n    environmentId: PropTypes.string.isRequired,\r\n    clientId: PropTypes.string.isRequired,\r\n    clientSecret: PropTypes.string,\r\n    scope: PropTypes.string.isRequired,\r\n    responseType: PropTypes.string,\r\n    tokenEndpointAuthMethod: PropTypes.string.isRequired,\r\n    grantType: PropTypes.string,\r\n    prompt: PropTypes.string,\r\n    redirectUri: PropTypes.string,\r\n    logoutRedirectUri: PropTypes.string,\r\n    maxAge: PropTypes.number\r\n  }).isRequired\r\n};\r\n\r\nexport default Home;\r\n","import React from 'react';\r\nimport {render} from 'react-dom';\r\nimport {BrowserRouter, Route, Switch} from 'react-router-dom';\r\nimport './index.css';\r\nimport config from \"./config\";\r\nimport Home from './components/home';\r\n\r\nrender(\r\n      <BrowserRouter>\r\n        <Switch>\r\n          <Route render={(routeProps) =>\r\n              <Home {...routeProps} {...config}/>}/>\r\n        </Switch>\r\n      </BrowserRouter>,\r\n    document.getElementById('root')\r\n);\r\n"],"sourceRoot":""}