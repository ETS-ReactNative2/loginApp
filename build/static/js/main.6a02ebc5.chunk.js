(this["webpackJsonppingone-customers-sample-custom-signon-client"]=this["webpackJsonppingone-customers-sample-custom-signon-client"]||[]).push([[0],{13:function(e,t,n){e.exports=n(28)},18:function(e,t,n){},28:function(e,t,n){"use strict";n.r(t);var s=n(0),a=n.n(s),o=n(11),i=n(30),r=n(31),c=n(32),l=(n(18),{authDetails:{environmentId:"fa669f8d-f31c-4b71-93b7-ca1906954c6f",responseType:"token id_token",clientId:"8445b17e-1d8e-4ebb-88be-502653b5570d",clientSecret:"",grantType:"implicit",redirectUri:"http://localhost:8080",logoutRedirectUri:"http://localhost:8080",scope:"profile address email phone",prompt:"login",tokenEndpointAuthMethod:"none",maxAge:3600},API_URI:"https://api.pingone.com/v1",AUTH_URI:"https://auth.pingone.com"}),d=n(3),m=n.n(d),p=n(7),h=n.n(p);const u=(e,t,n={})=>new Promise((s,a)=>h.a.post(e).withCredentials().send(n).set("Content-Type",t).end((e,t)=>{e?a(t?t.body:e):s(t.body)})),g=(e,t=!1,n={})=>new Promise((s,a)=>h.a.get(e).set(n).end((e,n)=>{e?a(n?n.body:e):s(t?n.body:n)})),I=e=>e?l.AUTH_URI:l.API_URI;var _=(e,t="token id_token",n,s,a,o,i,r="login",c,l=null)=>{let d="".concat(I(!0),"/").concat(e,"/as/authorize?")+"response_type=".concat(t,"&client_id=").concat(n,"&redirect_uri=").concat(s,"&prompt=").concat(r)+(a?"&scope=".concat(a):"")+(c?"&max_age=".concat(c):"")+(l?"&acr_values=".concat(l):"")+(o?"&state=".concat(o):"")+(i?"&nonce=".concat(i):"");window.location.replace(d)},f=(e,t,n,s)=>{let a="".concat(I(!0),"/").concat(e,"/as/signoff?id_token_hint=").concat(n);t&&s&&(a=a.concat("&post_logout_redirect_uri=".concat(t,"&state=").concat(s))),window.location.assign(a)},S=(e,t,n=null,s,a="authorization_code",o="client_secret_post",i)=>m.a.isEqual(o,"client_secret_post")?u("".concat(I(!0),"/").concat(e,"/as/token"),"application/x-www-form-urlencoded","grant_type=".concat(a,"&code=").concat(i,"&client_id=").concat(t)+(n?"&client_secret=".concat(n):"")+(s?"&redirect_uri=".concat(s):"")):g("".concat(I(!0),"/").concat(e,"/as/token?grant_type=").concat(a,"&code=").concat(i,"&client_id=").concat(t)+(n?"&client_secret=".concat(n):"")+(s?"&redirect_uri=".concat(s):"")),k=(e,t)=>g("".concat(I(!0),"/").concat(e,"/as/userinfo"),!0,{Authorization:"Bearer ".concat(t)}),E=()=>window.location.hash.replace("#","").split("&").reduce((e,t)=>Object.assign({[t.split("=")[0]]:decodeURIComponent(t.split("=")[1])},e),{}),v=()=>{let e=window.crypto||window.msCrypto,t=new Uint32Array(2);return e.getRandomValues(t),t[0].toString(36)};class b extends a.a.Component{constructor(e){super(e),this.state={userInfo:null,errorMessage:""},this.handleUserInfo=this.handleUserInfo.bind(this),this.hideUserInfo=this.hideUserInfo.bind(this)}getAccessToken(){let e=sessionStorage.getItem("access_token");return e?Promise.resolve(e):S(this.props.authDetails.environmentId,this.props.authDetails.clientId,this.props.authDetails.clientSecret,this.props.authDetails.redirectUri,this.props.authDetails.grantType,this.props.authDetails.tokenEndpointAuthMethod,sessionStorage.getItem("code")).then(e=>(sessionStorage.setItem("access_token",e.access_token),sessionStorage.setItem("id_token",e.id_token),sessionStorage.setItem("expires_in",e.expires_in),sessionStorage.setItem("scope",e.scope),Promise.resolve(e.access_token)))}hideUserInfo(){this.setState({userInfo:null})}handleUserInfo(){this.getAccessToken().then(e=>k(this.props.authDetails.environmentId,e)).then(e=>{this.setState({userInfo:e})}).catch(e=>{const t=m.a.get(e,"details[0].code",null);return m.a.isEqual(t,"INVALID_VALUE")?m.a.get(e,"details[0].message",null).includes("Access token expired")?this.setState({errorMessage:"Your access token is expired. Please login again."}):this.setState({errorMessage:m.a.get(e,"details[0].message",null)}):t?this.setState({errorMessage:t+m.a.get(e,"details[0].message",null)}):(m.a.get(e,"error",null)||m.a.get(e,"error_description",null))&&this.setState({errorMessage:m.a.get(e,"error",null)+": "+m.a.get(e,"error_description",null)}),Promise.reject(e)})}render(){const e=this.state,t=e.userInfo,n=e.errorMessage;let s=n&&a.a.createElement("div",{className:"alert alert-danger"},n);return t?a.a.createElement("div",null,s,a.a.createElement("div",{className:"input-field"},a.a.createElement("table",{className:"table"},a.a.createElement("thead",null,a.a.createElement("tr",null,a.a.createElement("th",null,"Claim"),a.a.createElement("th",null,"Value"))),a.a.createElement("tbody",null,Object.keys(t).map(e=>a.a.createElement("tr",{key:e},a.a.createElement("td",null,e),a.a.createElement("td",null,t[e])))))),a.a.createElement("div",{className:"input-field"},a.a.createElement("button",{type:"button",onClick:this.hideUserInfo}," Hide User Information"))):a.a.createElement("div",{className:"input-field"},s,a.a.createElement("button",{type:"button",onClick:this.handleUserInfo}," Show User Information"))}}var w=b;class y extends a.a.Component{constructor(e){super(e),this.state={userInfo:null,errorMessage:""},this.handleSignIn=this.handleSignIn.bind(this),this.handleSignOff=this.handleSignOff.bind(this)}handleSignIn(){const e=this.props.authDetails;this.clearSession();let t=v(),n=v();sessionStorage.setItem("state",t),_(e.environmentId,e.responseType,e.clientId,e.redirectUri,e.scope,t,n,e.prompt,e.maxAge)}handleSignOff(){sessionStorage.getItem("id_token")&&f(this.props.authDetails.environmentId,this.props.authDetails.logoutRedirectUri,sessionStorage.getItem("id_token"),sessionStorage.getItem("state")),this.clearSession()}clearSession(){sessionStorage.removeItem("access_token"),sessionStorage.removeItem("id_token"),sessionStorage.removeItem("code"),sessionStorage.removeItem("expires_in"),sessionStorage.removeItem("scope"),sessionStorage.removeItem("state")}componentDidMount(){const e=this.props.authDetails;/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e.environmentId)||this.setState({errorMessage:"Invalid environmentId parameter ".concat(e.environmentId," : it should be a valid UUID.  Please check it in your config.js parameters file.")});let t=E();if(t&&t.error&&t.error_description)return void this.setState({errorMessage:t.error+": "+t.error_description});let n=window.location.href.match("[?#&]state=([^&]*)");if(n&&!n[1]&&!m.a.isEqual(n[1],sessionStorage.getItem("state")))return void this.setState({errorMessage:"State parameter mismatch"});let s=window.location.href.match("[?#&]code=([^&]*)");t&&t.access_token&&t.id_token&&t.expires_in?(sessionStorage.setItem("access_token",t.access_token),sessionStorage.setItem("id_token",t.id_token),sessionStorage.setItem("expires_in",t.expires_in),sessionStorage.setItem("scope",t.scope)):s&&s[1]&&sessionStorage.setItem("code",s[1]),window.history.replaceState({},"","/")}render(){const e=this.state.errorMessage;let t=e&&a.a.createElement("div",{className:"alert alert-danger"},e);const n=!(sessionStorage.getItem("access_token")&&sessionStorage.getItem("id_token"))&&!/access_token|id_token/.test(window.location.hash)&&!sessionStorage.getItem("code")&&!/code/.test(window.location.href)?a.a.createElement("div",{id:"signInView"},a.a.createElement("p",null,"You are not currently authenticated. Click Sign On to get started."),a.a.createElement("div",{className:"input-field"},a.a.createElement("button",{type:"button",onClick:this.handleSignIn},"Sign On"))):a.a.createElement("div",{className:"home-app"},a.a.createElement("em",null,"Congratulations! This is a secure resource."),a.a.createElement("p",null),a.a.createElement("div",{className:"input-field"},a.a.createElement("button",{type:"button",onClick:this.handleSignOff}," Sign Off")),a.a.createElement(w,{authDetails:this.props.authDetails}));return a.a.createElement("div",{className:"container"},a.a.createElement("h1",null,"PingOne for Customers OIDC Sample"),t,n)}}var U=y;Object(o.render)(a.a.createElement(i.a,null,a.a.createElement(r.a,null,a.a.createElement(c.a,{render:e=>a.a.createElement(U,Object.assign({},e,l))}))),document.getElementById("root"))}},[[13,1,2]]]);
//# sourceMappingURL=main.6a02ebc5.chunk.js.map